---
title: "gdp_distribution"
output: html_document
date: "2023-08-09"
---
```{r}
library(dplyr)
library(stats)
library(tidyr)
library(purrr)
library(tsibble)
library(forecast)
library(maxLik)
library(stats4)
library(moments)
library(univariateML)
```

```{r}
library(readxl)
ip <-read_excel("DP_LIVE_09082023174326289.xlsx",col_types = c("text", "text", "text", 
         "text", "text", "text", "numeric", 
         "skip"))
View(ip)
usGDPC1_1_ <- read_excel("GDPC1 (1).xlsx")
View(usGDPC1_1_)
```
```{r}
options(scipen = 999)
```

```{r}
ip <- ip %>%
  group_by(LOCATION) %>%
  mutate(growthrate = (Value - dplyr::lag(Value, 1)) / dplyr::lag(Value, 1))

usGDPC1_1_=usGDPC1_1_ %>%
  mutate(growthrate = ( realgdp- dplyr::lag(realgdp, 1)) / dplyr::lag(realgdp, 1))

```
```{r}
ip <- ip %>%
  mutate(TIME = yearmonth(TIME))

ip_ts <- ip %>%
  group_by(LOCATION) %>%
  slice(-1) %>%
  as_tsibble(key = "LOCATION", index = "TIME")
usGDPC1_1_ts <- usGDPC1_1_ %>%
  mutate(observation_date = as.Date(observation_date)) %>%
  as_tsibble(index = "observation_date", regular = TRUE)


```



```{r}
calculate_acf_with_leads <- function(series, lag.max = 6, lead.max = 6) {
  # Remove missing values
  series <- na.omit(series)
  
  # Calculate ACF for lags
  acf_lags <- acf(series, lag.max = lag.max, plot = FALSE)$acf
  
  # Calculate ACF for leads (by reversing the series and calculating lags)
  acf_leads <- rev(acf(series[length(series):1], lag.max = lead.max, plot = FALSE)$acf)
  
  # Combine results, excluding the 0 lag from acf_lags as it's already included in acf_leads
  combined_acf <- c(acf_leads, acf_lags[-1])
  
  return(combined_acf)
}
```


```{r}
lag_max = 6
 lead_max = 6
 
 # Calculate average growth rate by location and time
 average_growthrate_by_location <- ip_ts %>%
     index_by(TIME) %>%
     summarize(growthrate = mean(growthrate, na.rm = TRUE), .groups = "drop")
# Apply the calculate_acf_with_leads function to the averaged series
 acf_with_leads_series1 <- calculate_acf_with_leads(average_growthrate_by_location$growthrate, lag.max = lag_max, lead.max = lead_max)
 
 # Apply the function to the other series
 acf_with_leads_series2 <- calculate_acf_with_leads(usGDPC1_1_ts$growthrate, lag.max = lag_max, lead.max = lead_max)
 
# Define the lags and leads
 lags_and_leads <- (-lead_max:lag_max)
 
 # Plot the results for series 1
 plot(lags_and_leads, acf_with_leads_series1, type = "l", ylim = c(-1, 1), main = "Comparison of Two Autocorrelations", xlab = "Lag/Lead", ylab = "ACF", col = "black")
 
 # Add the line for series 2
 lines(lags_and_leads, acf_with_leads_series2, col = "red")
 
 # Add a legend
 legend("topright", legend = c("ip oecd", "usgdpgrowthrate"), col = c("black", "red"), lty = 1)
 


```
```{r}
usgdp_list=usGDPC1_1_%>%drop_na%>%as.list(usGDPC1_1_$growthrate)


```
```{r}
dlaplace_standard <- function(x, mu = 0, b = 1) {
  if (b <= 0) return(NA)
  (1 / (2 * b)) * exp(1)^(-abs(x - mu) / b)
}

fit_standard <- MASS::fitdistr(usgdp_list$growthrate, dlaplace_standard, start = list(mu = 0, b = 1))
print(fit_standard)
hist(usgdp_list$growthrate, freq = FALSE, main = "Fit of Laplace Distribution", xlab = "Growth Rate")
curve(dlaplace_standard(x, mu = fit_standard$estimate['mu'], b = fit_standard$estimate['b']), add = TRUE, col = "red")
legend("topright", legend = "Fitted Laplace", col = "red", lty = 1)


```
```{r}
b_hat <- fit_standard$estimate[2]
SE_b <- fit_standard$sd[2]
Z <- (b_hat - 1) / SE_b
p_value <- 2 * pnorm(-abs(Z))
print(p_value)

```
```{r}

```


```{r}

#you are like I need to charge him more 

dlaplace <- function(x, m=0, a, b=1) {
  if(a <= 0 || b <= 0) return(NA)
  
  gamma_val <- gamma(1 + 1/b)
  part1 <- 1 / (2 * a * b^(1/b) * gamma_val)
  part2 <- exp()^((-1/b) * abs((x - m) / a)^b)
  
  result <- part1 * part2
  return(result)
}
usgdpgrowthrate <- # your data here
fit <- MASS::fitdistr(usgdp_list$growthrate, dlaplace, start = list(m = 0.0085194258 ,a=1 ,b =0.0073293483 ))
print(fit)


```



